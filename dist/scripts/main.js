"use strict";function handleTick(){if(1==play){if(!clicked&&stage.mouseX&&stage.mouseY&&(mouseTarget=stage.getObjectUnderPoint(mouseBp.x,mouseBp.y)),clicked&&mouseTarget){var e=String(mouseTarget.name);switch(e=e.substring(0,5)){case"dalek":createjs.Sound.play("sonic"),setExplosion(),resetEnemy(mouseTarget),addToScore(50);break;case"angel":createjs.Sound.play("sonic"),setExplosion(),resetEnemy(mouseTarget),addToScore(50);break;case"cyber":createjs.Sound.play("sonic"),setExplosion(),resetEnemy(mouseTarget),addToScore(50);break;case"tardi":createjs.Sound.play("sonic"),useCompanion(mouseTarget),mouseTarget.out=!1,stage.update(),addToLives(1);break;case"roset":createjs.Sound.play("sonic"),useCompanion(mouseTarget),mouseTarget.out=!1,resetAllEnemies(),stage.update(),addToScore(100)}clicked=!1}for(var a=enemyList.length,n=0;a>n;n++){var s=enemyList[n];if(s.x>-20)s.x-=s.speed;else{switch(s.name.substring(0,5)){case"cyber":createjs.Sound.play("delete");break;default:createjs.Sound.play("exterminate")}resetEnemy(s),addToLives(-1)}}for(var a=companionList.length,n=0;a>n;n++){var s=companionList[n];if(s.x>-20)s.x-=s.speed;else{switch(s.name.substring(0,5)){case"tardi":}resetCompanion(s)}}}canvas.onclick=handleClick,stage.update()}function loadingComplete(){canvas=document.getElementById("canvas"),scoreP=document.getElementById("score"),livesP=document.getElementById("lives"),levelP=document.getElementById("level"),stage=new createjs.Stage(canvas),stage.canvas.style.cursor="none",mouse=queue.getResult("sonic"),stage.addEventListener("stagemousemove",moveHandler),canvas.onmousedown=onMouseDown,canvas.onmouseup=onMouseUp,document.onkeydown=handleKeyDown,document.onkeyup=handleKeyUp,resetGame("Click to Start!"),createjs.Ticker.addEventListener("tick",handleTick)}function handleLoad(){createjs.Sound.play("theme",{loop:-1})}function moveHandler(){mouseBp.x=stage.mouseX,mouseBp.y=stage.mouseY}function handleKeyDown(e){32==e.keyCode&&(e.preventDefault(),clicked=!0)}function handleKeyUp(e){32==e.keyCode&&(e.preventDefault(),clicked=!1)}function handleClick(){canvas.onclick=null,stage.removeChild(gameTxt),play=!0}function onMouseDown(){if(!e)var e=window.event;clicked=!0}function onMouseUp(){clicked=!1}function setBG(e){bgrnd=new createjs.Bitmap(e),stage.addChild(bgrnd),stage.update()}function setSonic(){stage.removeChild(mouseBp),mouseBp=new createjs.Bitmap(mouse),stage.addChild(mouseBp),moveHandler(),stage.update()}function resetGame(e){play=!1,score=0,enemySpeed=1,changeLevel(1),resetAllEnemies(),changeGameText(e),stage.update()}function changeGameText(e){gameTxt=new createjs.Text(e,"36px Ariel","#fff"),gameTxt.textAlign="center",gameTxt.x=canvas.width/2,gameTxt.y=canvas.height/2,stage.addChild(gameTxt)}function addToScore(e){score+=e,score>=2e3&&1==level&&changeLevel(2),score>=7e3&&2==level&&changeLevel(3),score>=1e4&&3==level&&changeLevel(4),score>=15e3&&4==level&&changeLevel(5),score>=2e4&&5==level&&changeLevel(6),score>=5e4&&resetGame("You Defeated the Daleks!"),scoreP.innerText="Score: "+score}function addToLives(e){lives+=e,livesP.innerText="X "+lives,0>lives&&(livesP.innerText="X 0",resetGame("Game Over!"))}function changeLevel(e){switch(level=e,levelP.innerText="Level: "+e,stage.removeChild(bgrnd),setBG(queue.getResult("level"+e)),enemySpeed+=2,removeAllEnemies(),e){case 1:createEnemies(allEnemies.dalek,5),createCompanions(allCompanions.roset,1);break;case 2:createCompanions(allCompanions.tardi,1),createEnemies(allEnemies.dalek,5),createEnemies(allEnemies.angel,2),createCompanions(allCompanions.roset,1);break;case 3:createEnemies(allEnemies.dalek,5),createEnemies(allEnemies.angel,2),createEnemies(allEnemies.cyber,1),createCompanions(allCompanions.roset,1);break;case 4:createEnemies(allEnemies.dalek,5),createEnemies(allEnemies.angel,2),createEnemies(allEnemies.cyber,3),createCompanions(allCompanions.roset,1);break;case 5:createEnemies(allEnemies.dalek,5),createEnemies(allEnemies.angel,2),createEnemies(allEnemies.cyber,4),createCompanions(allCompanions.roset,1);break;case 6:createCompanions(allCompanions.tardi,1),createEnemies(allEnemies.dalek,5),createEnemies(allEnemies.angel,5),createEnemies(allEnemies.cyber,5),createCompanions(allCompanions.roset,1)}setSonic(),stage.update()}function createCompanions(e,a){var n=new createjs.Container;stage.addChild(n),a=a||1;for(var s=0;a>s;s++){var o=e.name,t=Math.floor(Math.random()*e.count)+1,i=queue.getResult(o+t),r=new createjs.Bitmap(i);n.addChild(r),r.name=o+s,r.out=!0,resetCompanion(r),r.regX=r.image.width/2|0,r.regY=r.image.height/2|0,r.mouseEnabled=!0,companionList.push(r)}}function resetCompanion(e){e.x=canvas.width+300*Math.random()+100,e.y=(canvas.height-100)*Math.random()+50,randomCompanionSize(e,8),e.speed=5*Math.random()+companionSpeed}function useCompanion(e){e.out&&(e.x=canvas.width+300*Math.random()+100,e.y=(canvas.height-100)*Math.random()+50,randomCompanionSize(e,8),e.speed=0)}function randomCompanionSize(e,a){var n=Math.floor(Math.random()*a)/10;e.scaleX=1+n,e.scaleY=1+n}function resetAllCompanions(){for(var e=companionList.length,a=0;e>a;a++){var n=companionList[a];resetCompanion(n)}}function removeAllCompanions(){companionList=[];for(var e=companionList.length,a=0;e>a;a++){var n=companionList[a];stage.removeChild(n)}}function createEnemies(e,a){var n=new createjs.Container;stage.addChild(n),a=a||1;for(var s=0;a>s;s++){var o=e.name,t=Math.floor(Math.random()*e.count)+1,i=queue.getResult(o+t),r=new createjs.Bitmap(i);n.addChild(r),r.name=o+s,r.out=!0,resetEnemy(r),randomEnemySize(r,8),r.regX=r.image.width/2|0,r.regY=r.image.height/2|0,r.mouseEnabled=!0,enemyList.push(r)}}function setExplosion(){function e(e){"explode"==e.name&&(e.remove(),stage.removeChild(o))}var a=queue.getResult("explosion"),n={framerate:10,images:[a],frames:{width:64,height:64,regX:32,regY:32},animations:{explode:[0,25,null,4]}},s=new createjs.SpriteSheet(n),o=new createjs.Sprite(s,"explode");o.x=mouseTarget.x,o.y=mouseTarget.y,stage.addChild(o),o.on("animationend",e)}function resetEnemy(e){e.x=canvas.width+300*Math.random()+100,e.y=(canvas.height-100)*Math.random()+50,randomEnemySize(e,8),e.speed=5*Math.random()+enemySpeed}function randomEnemySize(e,a){var n=Math.floor(Math.random()*a)/10;e.scaleX=1+n,e.scaleY=1+n}function resetAllEnemies(){for(var e=enemyList.length,a=0;e>a;a++){var n=enemyList[a];resetEnemy(n)}}function removeAllEnemies(){enemyList=[];for(var e=enemyList.length,a=0;e>a;a++){var n=enemyList[a];stage.removeChild(n)}}function createRose(){companionImage=queue.getResult("rose"),companionOut=!0,companion=new createjs.Bitmap(companionImage),stage.addChild(companion),companion.name="roset",resetCompanion(companion);var e=companion.image.width,a=(companion.image.height,36);companion.scaleX=companion.scaleY=a/e,companion.regX=0,companion.regY=0,companion.mouseEnabled=!0}var play,level=1,lives=3,score=0,canvas,stage,bg,bgrnd,gameTxt,mouseTarget,clicked,mouseBp,mouse,queue=new createjs.LoadQueue,audioPath="assets/",scoreP,livesP,levelP,sounds=[{id:"sonic",src:"sonic.mp3"},{id:"exterminate",src:"exterminate.mp3"},{id:"theme",src:"theme.mp3"},{id:"delete",src:"delete.mp3"}];createjs.Sound.registerSounds(sounds,audioPath),createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",handleLoad);var levels=[{id:"level1",src:"assets/gallifrey2.jpg"},{id:"level2",src:"assets/space.jpg"},{id:"level3",src:"assets/gallifrey.jpg"},{id:"level4",src:"assets/space2.jpg"},{id:"level5",src:"assets/badwolf.jpg"},{id:"level6",src:"assets/tardisexplode.jpg"}],images=[{id:"sonic",src:"assets/sonic.png"}];queue.loadManifest(levels),queue.loadManifest(images),queue.on("complete",loadingComplete,this);var companionSpeed=1,companionList=[],companionImageList=[{id:"tardi1",src:"assets/tardis.png"},{id:"roset1",src:"assets/rose.png"}];queue.loadManifest(companionImageList);var allCompanions={tardi:{name:"tardi",count:1},roset:{name:"roset",count:1}},enemySpeed=1,enemyList=[],daleks=[{id:"explosion",src:"assets/explosion.png"},{id:"dalek1",src:"assets/dalek.png"},{id:"dalek2",src:"assets/dalek2.png"},{id:"dalek3",src:"assets/dalek3.png"},{id:"dalek4",src:"assets/dalek4.png"},{id:"dalek5",src:"assets/dalek5.png"},{id:"angel1",src:"assets/weepingangel.png"},{id:"angel2",src:"assets/weepingangel2.png"},{id:"cyber1",src:"assets/cybermen.png"}];queue.loadManifest(daleks);var allEnemies={dalek:{name:"dalek",count:5},angel:{name:"angel",count:2},cyber:{name:"cyber",count:1}};